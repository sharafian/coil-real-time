<html>
<head>
  <title>CRT</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <script src="https://cdn.bootcss.com/flv.js/1.4.0/flv.min.js"></script>
  <script src="https://polyfill.webmonetization.org/polyfill.js"></script>
  <script src="https://cdn.coil.com/donate.js"></script>

  <script>
    window.WebMonetizationScripts.donate({
      paymentPointer: window.location.origin
    })
  </script>
</head>
<body>
  <nav>
    <div class="purple nav-wrapper">
      <a href="#" class="brand-logo" style="margin-left:0.5em">Coil Real-Time</a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li><a href="/browse.html">Browse</a></li>
      </ul>
    </div>
  </nav>

  <main class="container">
    <h4>Coil Stream Player</h4>
    <div class="row">
      <div class="col s8">
        <div class="card">
          <div class="card-image">
            <video width='100%' id="videoElement"></video>
          </div>
          <div class="card-content">
            <span id="videoTitle" class="card-title"></span>
            <p>Big Buck Bunny (code-named Peach) is a 2008 short computer-animated comedy film by the Blender Institute, part of the Blender Foundation. Like the foundation's previous film Elephants Dream, the film was made using Blender, a free software application for animation made by the same foundation.</p>
          </div>
          <div class="card-action">
            <a onclick="javascript:window.videoPlay()">Play Stream</a>
          </div>
        </div>
      </div>

      <div class="col s4">
        <ul class="z-depth-1 collection with-header">
          <li class="collection-header"><h4>Live Chat</h4></span>
          <li class="collection-item"><b>Dave:</b> Hey what up everyone</li>
          <li class="collection-item"><b>Bob:</b> Fuck off m8</li>
          <li class="collection-item"><b>Dave:</b> :monkas:</li>
          <li class="collection-item"><b>Alice:</b> Big buck bunny sure is out for blood this time</li>
          <li class="collection-item"><input type='text' /></li>
        </ul>
      </div>
    </div>
  </main>

  <script>
    if (flvjs.isSupported()) {
      var urlParams = new URLSearchParams(window.location.search)
      var videoName = urlParams.get('v')
      document.getElementById('videoTitle').innerText = atob(videoName)
      var videoElement = document.getElementById('videoElement')
      var flvPlayer = flvjs.createPlayer({
        type: 'flv',
        url: window.location.origin + '/live/' + videoName + '.flv'
      })
      flvPlayer.attachMediaElement(videoElement)
      flvPlayer.load()
      window.videoPlay = function () {
        flvPlayer.play()
      }
    }
  </script>
</body>
</html>
